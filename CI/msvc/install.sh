cd $APPVEYOR_BUILD_FOLDER
git submodule update --init --recursive

cd ..

curl -LfsS -o "vcpkg-export-${VCMI_BUILD_PLATFORM}-windows-v140.7z" \
	"https://public.by.files.1drv.com/y4mf0ARd5DKSUpXz-itVUx88CaAUYyrhzQ48hZ0-Q1lY1PjVHHvDaQU5oKpCIpgxs6LwkXYDG9JlNsXwtnZRAqi0gYHTuJWDW6B57XwiaAooi6-ZTkm9MMn96juHvJ0ruy1CRnuAky-NNRsLFpQ-Wz3OLseif6Zv6V7ZPywnfgdzNVLHjkg2kx0Iek7PiKQIZVPef8Q0-KbY_N-CkLejMIgYnAnRkgzM8LGWdluFQgZPRU?access_token=EwAYA61DBAAUmcDj0azQ5tf1lkBfAvHLBzXl5ugAATSS89QHauEgmRLfD5xMsas5/qAcArtc35j7gSqlv4E3xpVwSzwTOt599sfnZV%2bicSb3%2bG3cx%2beoWAwdYT21y%2bM%2byMHiLdEgc1fB7klC7T8nAd/fPysrXKPhjv%2b8gu2YAdeD06XplrBeUcyGG167mxq%2b418aGcpkRXD/5u%2b1eMia1PHTzOFWePk1uj4%2bVIyOLnJJaougMe4lUlTlP20QZI/rWqdf3ZhFyZGngBWoArF%2bG4dY2Ili6vcsLth9CyIAUK2J2hgIWPQCOekIBH7ZJGGT96kbUFMRVEFh6P/yxvNTJmjQsvl/X5Gm/7K/4jyg8TyhvJ7zA35i9tpcLi7md9IDZgAACJB2CC26mCwm6AHkhDZiy6SoTO4yLhS6/zT/ld0IqZRTLMSU%2bz8ZqHH4u/9zYRwMXmPGx2oG/5EycWykFp/hlXPoVmv3Q5YzfuZl6ooCVRdvG4OwL7F0GCYHZ0uO2LcuLy4QxJfrWjLRQIGpgipsdffvDFk9e37WYfI4vs6NUWFazgSaR/GFJYwcOH5JS4XloS2Ggi2FBIUlYy/cxWf9CBBcqyp/Qaf5uHVMrk1NhWiQDwtDKKXYy81DaEd621JtSzY38MF%2bgDb9iV81%2bzcb1itsBpOVwLTR%2bA9dsxc1pPwJ8XJqOHKTd89pAXyFjLYYw%2bgPg4zuqu3nfRBiByhmBw10Y3MF6wEywM9ERZe3euHreP36ZHz3mltMv9nATk841KPG%2bGm/KrMa6kYEagY2L4%2bsxNbV16Ln/FVitY1gL4JDkK%2bRSJpZ3TojIjsr/uoBqi3kneEnFx5M38s57Fibk5IarIMZHaWdxbDH4VS3p5gf506G9NEvadjpf7hwaEqaWN0KfuNksYNJQFsUfX0cjeczVWkqTGpR%2bdiKss/V3yKewYKW2ijT6sMrTlTo6WoamEYb6pzEn/WUpv3Z%2bdeYqsjRwPD7e0oLvuO1VL4IKBIXyY7N1oIDw8YVNqpdnqwGp4QqUjy3x4/DbJZdpmqIj%2bQKxRwC"
7z x "vcpkg-export-${VCMI_BUILD_PLATFORM}-windows-v140.7z"

rmdir vcpkg\installed\${VCMI_BUILD_PLATFORM}-windows\debug /S/Q
xcopy vcpkg\installed\${VCMI_BUILD_PLATFORM}-windows\bin vcpkg\installed\${VCMI_BUILD_PLATFORM}-windows\debug\bin /S/I/Q

cd $APPVEYOR_BUILD_FOLDER
mkdir build_$VCMI_BUILD_PLATFORM
cd build_$VCMI_BUILD_PLATFORM

source $APPVEYOR_BUILD_FOLDER/CI/get_package_name.sh
cmake -G "$VCMI_GENERATOR" .. -DCMAKE_TOOLCHAIN_FILE=$APPVEYOR_BUILD_FOLDER/../vcpkg/scripts/buildsystems/vcpkg.cmake \
	-DPACKAGE_NAME_SUFFIX:STRING="$VCMI_PACKAGE_NAME_SUFFIX" \
	-DPACKAGE_FILE_NAME:STRING="$VCMI_PACKAGE_FILE_NAME"
